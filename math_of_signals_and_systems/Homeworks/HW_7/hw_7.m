%% Problem 4
%with pivoting
A = [2  4   -5;...
    6   12.001  1;...
    4   -8      -3];
P12 = [0    1   0;...
    1       0   0;...
    0       0   1];
E1 = [1     0   0;...
    -2/6    1   0;...
    -4/6    0   1];
E1_P12_A = E1*P12*A;
P23 = [1 0  0;...
    0   0   1;...
    0   1   0];
P23_E1_P12_A = P23*E1_P12_A;

E2 = [1 0   0;...
    0   1   0;...
    0   -P23_E1_P12_A(3,2)/P23_E1_P12_A(2,2)   1];

E2_P23_E1_P12_A = E2*P23*E1_P12_A;
U = E2_P23_E1_P12_A;
L = P23*inv(E1)*P23*inv(E2);

P = P23*P12;
b = [-5; 33.002; -21];
Pb = P*b;
y1 = Pb(1);
y2 = Pb(2) - y1*L(2,1);
y3 = Pb(3) - y1*L(3,1) - y2*L(3,2);

x3 = y3/U(3,3);
x2 = (y2 - U(2,3)*x3)/U(2,2);
x1 = (y1 - U(1,2)*x2 - U(1,3)*x3)/U(1,1);

%without pivoting
E1 = [1 0   0;...
    -3  1   0;...
    -2  0   1];
E1_A = E1*A;
E2 = [1 0   0;...
    0   1   0;...
    0   -E1_A(3,2)/E1_A(2,2)    1];
E2_E1_A = E2*E1_A;
U = E2_E1_A;
L = inv(E1)*inv(E2);
y1 = b(1);
y2 = b(2) - y1*L(2,1);
y3 = b(3) - y1*L(3,1) - y2*L(3,2);

x3 = y3/U(3,3);
x2 = (y2 - U(2,3)*x3)/U(2,2);
x1 = (y1 - U(1,2)*x2 - U(1,3)*x3)/U(1,1);

%% Problem 22
clear all
clc
A = [...
    10000   10001;...
    10001   10002;...
    10002   10003;...
    10003   10004;...
    10004   10005];
b = [20001; 20003; 20005; 20007; 20009];

% part (a)
cond_A = cond(A);
cond_AtA = cond(A'*A);

% part (b)
xhat = inv(A'*A)*A'*b;

% part (c)
[Q,R] = qr(A);
c = Q'*b;
c = c(1:2);
Rhat = R(1:2,:);
xqr1 = c(2)/Rhat(2,2);
xqr2 = (c(1) - Rhat(1,2))/Rhat(1,1);
xqr = [xqr1; xqr2];

% part (d)
AtA = A'*A;
L = chol(AtA,'lower');
Lt = L';
c = A'*b;
y1 = c(1)/L(1,1);
y2 = (c(2) - L(2,1)*y1)/L(2,2);
x2 = y2/Lt(2,2);
x1 = (y1 - Lt(1,2)*x2)/Lt(1,1);


